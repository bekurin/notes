### 생성 날짜: 2024-04-01T20:28
### 주제: 글로벌 애플리케이션 분산과 스테이지
---
### 본문:

> 글로벌 배포의 가장 흔한 이유는 지역성입니다. 대역폭이나 데이터 프라이버스의 이유로 애플리케이션을 가능하게 만들기 위해 특정 리전에 배치해야 하는 경우가 있습니다. P.129

글로벌 배포를 해야하는 이유를 대역폭만 생각하고 있었는데 지역의 법에 따라 대역폭이나 트래픽이 높지 않아도 글로벌 배포를 해야하는 경우가 발생할 수 있다는 것을 깨달았다.

## 이미지 분산

> 이미지 풀 레이턴시는 클러스터 구동 시간에 영향을 줍니다. p.130

팟이 재시작을 하게 된다고 생각해도 이미지를 다운로드 하는 시간이 길수록 CI/CD 시간도 길어지면서 장애 대응 시간도 길어지게 된다. ex. 롤백, 핫픽스 모두 느려진다.

> 해당 데이터 센터의 대규모 사고로 인해 레지스트리가 오프라인 상태로 전환될 수 있습니다. p.130

단일 레지스트리를 사용 중인데 사고로 인해 오프라인 상태가 된다면 이도저도 할 수 없는 상태가 될 것이다.

ECR의 설정이 어떻게 되어 있는지 모르겠지 웬만하면 단일 레지스트리는 피하는 것이 좋을 것 같다는 생각이 든다.

## 배포 파라미터화
> 리전에 따라 부하가 달라질 수 있으므로 크기나 설정도 바꿔야 합니다. p.131

> 공통 설정은 단일 템플릿에 보관되어 모든 지역에 공유되고, 매개변수를 템플릿에 적용하면 지역에 특화된 설정을 생성할 수 있습니다. P.131

템플릿화 할 수 있는 것들은 템플릿 화를 진행하고, 리전에 따라 대역폭 및 트래픽이 다르므로 설정을 다르게 해야한다.

> 이러한 복잡성을 편리하게 관리하는 것이 글로벌 애플리케이션 성공의 핵심 요소입니다. p.131

key.1
## 글로벌 트래픽 로드 밸런스
> 다양한 리전의 디플로이먼트에 대한 트래픽 밸런스를 올바르게 설정하는 것이 시스템의 성능과 안정성을 위한 핵심입니다. p.131

key.2

> DNS 프로토콜을 사용하여 여러 리전 엔드포인트 간에 로드 밸런싱을 할지 여부입니다. p.132

www.google.com은 접속하는 지역에 따라 같은 url로 여러 리전의 트래픽을 로드 밸런싱한다. 어떻게 하는거지??

하나가 모든 트래픽을 받는 것?? 아니면 진입하자마자 ALB에 의해 서로 다른 리전으로 트래픽이 나눠지는 지?? 아니면 가까운 라우터가 지역에 따라서 알아서 판단하는 것인지??

## 안정적인 글로벌 롤아웃

> 스테이지 방식을 사용하여 보다 신중하게 롤아웃하는 것이 낫습니다. 글로벌 로드 밸런싱과 결합한다면 중대한 장애에 직면했을 때에도 고가용성을 유지할 수 있습니다. P.132

스테이지 환경을 운영 환경과 완전하게 동일하게 구성할 수 있다면 충분히 활용가치가 있을 것 같다. 그렇지 않다면 개발 환경과 스테이지, 운영 환경의 차이가 미비해진다고 생각한다.

글로벌 로드 밸런싱을 결합한다는 것은 대만/한국 서버가 있다고 할 때 한국 서버에 장애가 발생하면 대만 서버는 문제 없다는 것을 의미하는 것인지?? 한국 서버가 장애가 발생하면 대만 서버로 트래픽을 돌린다는 것인지??

> 애플리케이션이 올바르게 동작할 거라는 신뢰를 얻은 만큼의 충분한 테스트를 거쳤어야 합니다. 그렇다고 운영에서 애플리케이션이 올바르게 동작할 거라는 의미는 아닙니다. P.132

테스트 커버리지 100%를 찍어도 올바르게 동작하지 않을 수 있다. 테스트는 사람이 작성하는 것이고, 사람은 실수할 수 있기 때문이다.
(헬름 차트와 더불어서 발생하는 문제가 생길 수도 있기도 하고)

## 사전 롤아웃 검증

> 현업에서 애플리케이션의 데이터가 500GB인 경우, 사전 운영 테스트에서의 데이터 크기도 이와 비슷해야 합니다. (가능하면 동일한 크기가 좋습니다). p.133

구/신 마이그레이션의 경우 운영 환경의 데이터 스냅샷을 떠서 스테이지 환경에 데이터를 밀어넣고, 테스트를 했다.

> 애플리케이션 개발 초기 단계부터 준비하여 현실적인 통합 테스트 데이터를 설정하는 것이 모범 사례로 여겨집니다. P.133

운영 환경의 데이터가 많이 쌓여있을 때 스테이지 환경을 구성하면 시간이 많이 드니까 서비스 초기부터 간간이 데이터를 쌓아두라는 것으로 이해된다.

> 통합 테스트의 목표는 환경 구성 방식과 상관없이 모두 같습니다. 일련의 입력과 상호작용이 주어졌을 때 애플리케이션이 예상대로 동작하는지 검증하는 겁니다. P.133

통합 테스트의 목표를 간단명료하게 설명하는 것 같다. 테스트 도구에도 구애받지 않는 다는 것을 명시하는 것도 좋을 것 같다는 생각이 들었다.

> 통합 테스트를 통해 애플리케이션이...부하 테스트도 추가로 수행해야 합니다. 애플리케이션이 올바르게 동작하는지 검증하는 것과 현업에서 부하를 잘 견딜 수 있는지 증명하는 것은 다른 얘기입니다. P.134

부하 테스트도 간단명료하게 설명해준다... :+1
하지만 통합 테스트와 부하 테스트를 매번 실행하는 것은 굉장한 시간이 든다. 특히, 부하 테스트는 수많은 트래픽이 한번에 몰릴 때 올바르게 동작하는 지 검증해야하기 때문에 매번 시나리오가 달라진다. 그렇다면 시간이 부족한 것에 따라 양자택일을 해야하는 것인데 그런 상황이 벌어진다면 나는 통합 테스트를 꼼꼼하게 작성하고, 모니터링을 열심히 할 것 같다.

모든 기능이 올바르게 동작한다는 전제하에 핫픽스를 할 수 있으니까,,,

## 카나리 리전

안정적인 롤아웃을 위해서는 카나리 리전 배포가 기본이 되어야한다. 이유는 새로운 버전에 대해 일부 외부/내부 사용자에게 오픈하여 피드백 또는 버그를 제보 받을 수 있기 때문에...

> 카나리의 목표는 릴리스의 초기 피드백을 받는 것이므로, 며칠 동안 릴리스를 카나리 리전에 유지하는 것이 좋습니다. p.135

굿 :+1

## 리전 타입 식별

통합 테스트/카나리 배포/부하 테스트를 모두 실행해도 문제가 발생할 수 있다. 이런 문제를 해결하기 위해 추가적으로 고민할 수 있는 부분이 2가지 있고, 다음과 같다.
- 지역 특성에 따른 트래픽 차이 (개발도상국 예시)
- 지역에 따른 언어의 차이 (한국어, 영어, 일본어, 중국어 등등)

## 글로벌 롤아웃 구축
> 가장 먼저 카나리 리전이나 사용자 트래픽이 적은 리전을 시작점으로 고려하는 것이 좋습니다. p.136

적은 사람이 피해를 보기 때문에 선택하는 것이 당연하다고 할 수 있지만 뭔가,,, 트롤리 딜레마와 비슷하다.

저자는 적은 리전 순서대로 롤아웃을 진행하고, 충분한 대기 시간을 가진다면 문제없이 배포를 할 수 있을 것이라고 생각한다.

## 문제 발생 시 대처

> 너무 당연해 보이는 것들까지 포함하여 모든 단계를 작성하세요. P.138

저자가 말한 것과 같이 스트레스를 받는 상황에서는 간단한 것도 기억하지 못할 수 있다. 위와 같은 대처 방법을 작성해두면 분명 도움이 될 것 같다.

다음에는 문제 대응을 위한 모든 작업 단계를 인지하고 있어야하고, 서로 다른 리전의 트래픽을 드레인 하여 다른 리전으로 옮기는 연습을 해야한다는 것을 말합니다.

---
### 참고문헌
- 
---
### 연결문서
- 

